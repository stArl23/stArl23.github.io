<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Minuv2靶机渗透实战 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="##前言 &amp;emsp;&amp;emsp;这个靶机是暑假中间的时候找到的，做下来主要的感觉就是还是偏信息收集这块，基本上没有什么需要高技巧的操作，然而我还是，，，果然还是缺乏经验。 ##环境以及工具介绍 &amp;emsp;&amp;emsp;虚拟机parallers，本机macOS ip 10.211.55.2，kali攻击机 ip 10.211.55.4，靶机 ip 10.211.55.14，kali和靶机均设置为共">
<meta name="keywords" content="渗透测试,信息收集">
<meta property="og:type" content="article">
<meta property="og:title" content="Minuv2靶机渗透实战">
<meta property="og:url" content="http://wanghuidi.github.io/2019/09/11/Minuv2靶机渗透实战/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="##前言 &amp;emsp;&amp;emsp;这个靶机是暑假中间的时候找到的，做下来主要的感觉就是还是偏信息收集这块，基本上没有什么需要高技巧的操作，然而我还是，，，果然还是缺乏经验。 ##环境以及工具介绍 &amp;emsp;&amp;emsp;虚拟机parallers，本机macOS ip 10.211.55.2，kali攻击机 ip 10.211.55.4，靶机 ip 10.211.55.14，kali和靶机均设置为共">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="https://i.loli.net/2019/09/11/4lMjswWDRgckp6T.png">
<meta property="og:image" content="https://i.loli.net/2019/09/11/DtpY3o5nJegcyTS.png">
<meta property="og:image" content="https://i.loli.net/2019/09/11/iXWuTGrNEUnxyFl.png">
<meta property="og:image" content="https://i.loli.net/2019/09/12/8C1tsA2SPrZXc3u.png">
<meta property="og:image" content="https://i.loli.net/2019/09/12/aheb3JN4WBHKoQO.png">
<meta property="og:image" content="https://i.loli.net/2019/09/12/rOXPFQnUHpzAEhT.png">
<meta property="og:updated_time" content="2019-09-12T00:42:39.062Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Minuv2靶机渗透实战">
<meta name="twitter:description" content="##前言 &amp;emsp;&amp;emsp;这个靶机是暑假中间的时候找到的，做下来主要的感觉就是还是偏信息收集这块，基本上没有什么需要高技巧的操作，然而我还是，，，果然还是缺乏经验。 ##环境以及工具介绍 &amp;emsp;&amp;emsp;虚拟机parallers，本机macOS ip 10.211.55.2，kali攻击机 ip 10.211.55.4，靶机 ip 10.211.55.14，kali和靶机均设置为共">
<meta name="twitter:image" content="https://i.loli.net/2019/09/11/4lMjswWDRgckp6T.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://wanghuidi.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Minuv2靶机渗透实战" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/11/Minuv2靶机渗透实战/" class="article-date">
  <time datetime="2019-09-11T13:03:24.000Z" itemprop="datePublished">2019-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Minuv2靶机渗透实战
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##前言</p>
<p>&emsp;&emsp;这个靶机是暑假中间的时候找到的，做下来主要的感觉就是还是偏信息收集这块，基本上没有什么需要高技巧的操作，然而我还是，，，果然还是缺乏经验。</p>
<p>##环境以及工具介绍</p>
<p>&emsp;&emsp;虚拟机parallers，本机macOS ip 10.211.55.2，kali攻击机 ip 10.211.55.4，靶机 ip 10.211.55.14，kali和靶机均设置为共享网络模式。<br>抓包工具bp，浏览器firefox。</p>
<p>##流程介绍</p>
<h3 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1.信息收集"></a>1.信息收集</h3><ul>
<li><p>首先是要找到靶机的ip和开放的端口，这里直接用nmap去扫。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -v -sP 10.211.55.0/24</span><br><span class="line">nmap -A 10.211.55.14</span><br></pre></td></tr></table></figure>

<p>10.211.55.2是本机，10.211.55.14应该就是靶机，然后把所有脚本跑一遍，发现开启了两个口一个是22另外一个是3306。<br><img src="https://i.loli.net/2019/09/11/4lMjswWDRgckp6T.png" alt="image.png"> </p>
</li>
<li><p>linux版本3以上</p>
</li>
<li><p>22毫无疑问是ssh服务，然而这个3306端口似乎并不是mysql服务，我试试直接访问。<br><img src="https://i.loli.net/2019/09/11/DtpY3o5nJegcyTS.png" alt="image.png"><br>看起来是web服务。</p>
</li>
<li><p>拿dirsearch跑下看看有什么发现。发现上传页面upload.html，要求上传svg文件。猜测一波可能有文件上传漏洞。</p>
</li>
<li><p>看了下http包的header。发现有 <b>X-Powered-By<br>Kemal</b>这串数据，查找治疗后后发现是一个国外的轻量级web框架。<br>不是php开发的。<a href="https://github.com/kemalcr/kemal" target="_blank" rel="noopener">https://github.com/kemalcr/kemal</a></p>
</li>
</ul>
<h3 id="2-试图获取webshell"><a href="#2-试图获取webshell" class="headerlink" title="2.试图获取webshell"></a>2.试图获取webshell</h3><ul>
<li>随便找了张图片转成了svg上传抓包，发现svg是由xml构成的，临时打算试了下xml的实体解析漏洞，尝试读取/etc/passwd。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" standalone="no"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"</span></span><br><span class="line"><span class="meta"> "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">width</span>=<span class="string">"1305.600000pt"</span> <span class="attr">height</span>=<span class="string">"1094.400000pt"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 1305.600000 1094.400000"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">preserveAspectRatio</span>=<span class="string">"xMidYMid meet"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">metadata</span>&gt;</span></span><br><span class="line">Created by potrace 1.13, written by Peter Selinger 2001-2015</span><br><span class="line"><span class="tag">&lt;/<span class="name">metadata</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">g</span> <span class="attr">transform</span>=<span class="string">"translate(0.000000,1094.400000) scale(0.080000,-0.080000)"</span></span></span><br><span class="line"><span class="tag"><span class="attr">fill</span>=<span class="string">"#000000"</span> <span class="attr">stroke</span>=<span class="string">"none"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>响应<br><img src="https://i.loli.net/2019/09/11/iXWuTGrNEUnxyFl.png" alt="image.png"><br>这里确定了就是信息泄露了。整理下了，发现能用的就这些。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">employee:x:1000:1000:Linux User,,,:/home/employee:/bin/ash</span><br><span class="line">postgres:x:70:70::/var/lib/postgresql:/bin/sh</span><br></pre></td></tr></table></figure>

<p>基本上可登录的用户就两个，一个是root，另外一个是employee，感觉可以尝试获取employee的密码后登录，然后再获取超级账号。在这个思路指导下，我还尝试了/etc/shadow，/etc/hosts等文件，基本上没有什么收货。</p>
<ul>
<li>尝试读取employee的命令行记录，由于知道employee的shell是ash所以，尝试获取.ash_history。获取密码superultrapass3。然后成功登陆系统。</li>
<li>uname -a 查看操作系统的版本<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux minuv2 4.19.58-0-virt #1-Alpine SMP Wed Jul 10 13:00:23 UTC 2019 x86_64 Linux</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>感觉内核不是特别老，exploit db上也没找到相关的信息，感觉不是直接提权。</p>
<ul>
<li>通过which命令发现机子上并没有，pyhton和php环境，连/dev/tcp也没有，但发现有perl，可以连一句话。但这里好像也没什么用了。</li>
<li>没有sudo，su可用，基本上除了根目录就没什么能写能看的文件。</li>
</ul>
<h3 id="3-提权"><a href="#3-提权" class="headerlink" title="3.提权"></a>3.提权</h3><p>&emsp;&emsp;提权的时候，大概有这么几种思路：</p>
<ol>
<li><p>内核提权，这个需要结合靶机的内核和靶机的环境，比如dirtycrow就只能在3.1到3.78版本的内核上用</p>
</li>
<li><p>攻击以管理员权限运行的服务，比如httpd，mysql等等，利用root权限运行的服务，尝试获取root shell。</p>
</li>
<li><p>suid代表设置用户id，linux通过suid机制使非指定用户使用某些指定用户才能使用的功能。例如ping命令需要用root权限打开原始套接字，而ping命令有suid所以普通用户也可以使用ping命令。我们可以通过一些拥有root权限的程序获取root shell，或者对现有文件做一些更改，比如/etc/passwd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用sudo权限<br>等等</p>
</li>
</ol>
<p>&emsp;&emsp;这里我发现可以用micro编辑器修改文件，从而获取和root同样分组的用户<br><img src="https://i.loli.net/2019/09/12/8C1tsA2SPrZXc3u.png" alt="image.png"><br>这里可以添加新用户或者直接修改employee的权限，但要注意，最后一行记录后需要换行，不然会出现can’t use /bin/as这个错误。<br><img src="https://i.loli.net/2019/09/12/aheb3JN4WBHKoQO.png" alt="image.png"></p>
<p>最后cd /root 获取flag.txt</p>
<p><img src="https://i.loli.net/2019/09/12/rOXPFQnUHpzAEhT.png" alt="image.png"></p>
<h2 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h2><p>&emsp;&emsp;这个靶机其实还算是简单，但是由于不是特别熟悉思路，还是花了好久才做出来。那个查当前用户的命令记录还真的没想到。怎么说呢，还是一个思路广度和对资料利用的问题，好多地方都是最后差了一点。</p>
<p>Reference: </p>
<ul>
<li><a href="https://www.xmsec.cc/guide-linux-privilege-escalation/" target="_blank" rel="noopener">https://www.xmsec.cc/guide-linux-privilege-escalation/</a> 这篇关于提权的博客很好</li>
<li><a href="https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html</a> 一句话shell的资料</li>
<li><a href="https://www.cnblogs.com/hack404/p/11350499.html" target="_blank" rel="noopener">https://www.cnblogs.com/hack404/p/11350499.html</a> wp</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://wanghuidi.github.io/2019/09/11/Minuv2靶机渗透实战/" data-id="ck0t7ik5j000076641g4uydza" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/信息收集/">信息收集</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/渗透测试/">渗透测试</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/09/21/xss练习小结/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          xss练习小结
        
      </div>
    </a>
  
  
    <a href="/2019/09/02/shell编程基础/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">shell编程基础</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/500lines/">500lines</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql注入/">sql注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/">xss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xxe注入/">xxe注入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/信息收集/">信息收集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件上传/">文件上传</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/渗透测试/">渗透测试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/500lines/" style="font-size: 10px;">500lines</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/sql注入/" style="font-size: 10px;">sql注入</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/xxe注入/" style="font-size: 10px;">xxe注入</a> <a href="/tags/信息收集/" style="font-size: 10px;">信息收集</a> <a href="/tags/文件上传/" style="font-size: 10px;">文件上传</a> <a href="/tags/渗透测试/" style="font-size: 10px;">渗透测试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/21/xss练习小结/">xss练习小结</a>
          </li>
        
          <li>
            <a href="/2019/09/11/Minuv2靶机渗透实战/">Minuv2靶机渗透实战</a>
          </li>
        
          <li>
            <a href="/2019/09/02/shell编程基础/">shell编程基础</a>
          </li>
        
          <li>
            <a href="/2019/08/20/简易python模板引擎其一/">简易python模板引擎其一</a>
          </li>
        
          <li>
            <a href="/2019/08/11/xxe注入入门/">xxe注入入门</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 star<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>